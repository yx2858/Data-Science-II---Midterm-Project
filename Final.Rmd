---
title: "temp title"
author: "Jixin Li (jl6648), Alex McCreight (apm2217), Yueyi Xu (yx2858)"
output: pdf_document
date: "Spring 2024"
geometry: margin=1in
fontsize: 12pt
spacing: double
bibliography: Library.bib
csl: vancouver-superscript.csl
---

```{r libraries-data-cleaning, include = F}
library(tidyverse)
library(glmnet)
library(caret)
library(tidymodels)
library(pls)
library(corrplot)
library(knitr)

load("recovery.RData")

dat$gender <- as.factor(dat$gender)
dat$race <- as.factor(dat$race)
dat$smoking <- as.factor(dat$smoking)
dat$hypertension <- as.factor(dat$hypertension)
dat$diabetes <- as.factor(dat$diabetes)
dat$vaccine <- as.factor(dat$vaccine)
dat$severity <- as.factor(dat$severity)
dat$study <- as.factor(dat$study)

dat <- dat %>%
  select(-id) %>% 
  mutate(
    gender = case_when(
      dat$gender == 1 ~ "Male",
      TRUE ~ "Female"),
    race = case_when(
      dat$race == 1 ~ "White",
      dat$race == 2 ~ "Asian",
      dat$race == 3 ~ "Black",
      TRUE ~ "Hispanic"),
    smoking = case_when(
      dat$smoking == 0 ~ "Never Smoked",
      dat$smoking == 1 ~ "Former Smoker",
      TRUE ~ "Current Smoker")) %>% 
  mutate_if(is.character, as.factor) %>% 
  mutate(race = relevel(race, ref = "White"),
         smoking = relevel(smoking, ref = "Never Smoked"),
         study = relevel(study, ref = "B"))
```

## Introduction

The severe acute respiratory syndrome coronavirus 2 (SARS-CoV-2) was first identified in China in December 2019. Since then, the COVID-19 pandemic poses a significant public health threat, particularly affecting older adults and individuals with chronic health conditions. Factors such as age, gender, vaccination status, the severity of COVID-19 symptoms, and pre-existing chronic illnesses play a crucial role in determining the recovery time for patients[@Factors].

In this project, we use statistical methods and fit models based on factors that potentially affect COVID-19 recovery time. We begin by examining the data and selecting appropriate variables for modeling. Next, we fit multiple models and assess their test errors. Ultimately, we select the model with the lowest test error to accurately predict COVID-19 recovery time.

## Exploratory analysis and data visualization

With the goals of developing a prediction model for COVID-19 recovery time and identifying important risk factors for long recovery in mind, we first ran an exploratory analysis of all variables in our data set to visualize their relationship with recovery time. Our findings revealed that recovery time has a small positive correlation with age and weight, and a slightly stronger positive association with BMI. Conversely, height has a small negative relationship with recovery time.

Among the discrete variables, we observed substantial differences in recovery time based on vaccination status as well as COVID-19 severity. Individuals who received the COVID-19 vaccine had shorter recovery times, on average, compared to those who have not received the vaccine (Figure 2). Additionally, those with "severe" COVID-19 had longer recovery times, on average, compared to those with "non-severe" COVID-19 (Figure 3).

Interestingly, we found a saw that those with diabetes had a shorter time to recovery compared to those without diabetes, which immediately seems counter intuitive (Figure 1). However, upon further literature review, we posit that those with diabetes in these studies either died more quickly compared to those without diabetes, or those with long-COVID and lived most likely had well-managed diabetes and took extra precautions against COVID-19 compared to those without diabetes[@diabetes].

Finally, we observed a significant difference in the variability of recovery times of participants in study A versus study B. The exact reasons for this discrepancy are unclear, however, we hypothesize that study A was conducted when the vaccines were more available leading to reduced variability in recovery time compared to study B. 

```{r, echo = F}
dat %>%
  mutate(diabetes = case_when(
    dat$diabetes == 1 ~ "Has Diabetes",
    TRUE ~ "No Diabetes"
  )) %>% 
  ggplot(aes(x = diabetes, y = recovery_time)) +
    geom_boxplot() +
    theme_classic() + 
    labs(x = "Diabetes Status", y = "Recovery Time (in days)", title = "Figure 1: Diabetes Status vs Time to Recovery")
```

```{r, echo=FALSE}
dat %>%
  mutate(vaccine = case_when(
    dat$vaccine == 1 ~ "Vaccinated",
    TRUE ~ "Not vaccinated"
  )) %>% 
  ggplot(aes(x = vaccine, y = recovery_time)) +
    geom_boxplot() +
    theme_classic() + 
    labs(x = "Vaccination status at the time of infection", y = "Recovery Time (in days)", title = "Figure 2: Vaccination status vs Time to Recovery")
```

```{r, echo=FALSE}
dat %>%
  mutate(severity = case_when(
    dat$severity == 1 ~ "Severe",
    TRUE ~ "Not severe"
  )) %>% 
  ggplot(aes(x = severity, y = recovery_time)) +
    geom_boxplot() +
    theme_classic() + 
    labs(x = "Severity of COVID-19 infection", y = "Recovery Time (in days)", title = "Figure 3: severity vs Time to Recovery")
```


  
## Model training

In this section, describe the models you used to predict the time to recovery from COVID-19. Briefly state the assumptions made by using the models. Provide a detailed description of the model training procedure and how you obtained the final model.

## Results

In this section, report the final model you built to predict the time to recovery from COVID-19. Interpret the model and assess its performance.


## Conclusions

In this section, summarize your findings from the model analysis and discuss the insights gained into predicting time to recovery from COVID-19.

### Additional Considerations

In your modeling efforts, did you include "study" as a predictor variable? Provide a rationale for your decision, considering the variable's relevance and potential impact on model accuracy and interpretability.

## References
\[@Factors\]: Al-Thaqafy MS, Batahaf R, Bahakeem R, Batarjee R, Mubaraki W, Alsaedi A, Alghamdi LA, Al Nufaiei ZF. Factors Affecting Confirmed COVID-19 Patient's Recovery Time at King Abdulaziz Medical City, Jeddah. Cureus. 2023 Jan 24;15(1):e34130. doi: 10.7759/cureus.34130.
